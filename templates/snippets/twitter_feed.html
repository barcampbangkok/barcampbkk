<script src="/site_media/static/pinax/js/jquery-1.3.2.min.js" type="text/javascript"></script>
<script language="javascript">
    var feed = []
    fetch_tweets_user_timeline();
    fetch_tweets_from_hash_tags();

    function fetch_tweets_user_timeline() {
        var twitterUsername = 'barcampbangkok';
        var url = "http://twitter.com/status/user_timeline/" +
            twitterUsername +
            ".json?count=5&callback=?";
        $.getJSON( url, user_timeline_call_back );
    }

    function user_timeline_call_back( results ) {
        add_to_feed( results )
        var list = feed_to_html();
        $( "#output" ).append( list );
    }

    function fetch_tweets_from_hash_tags() {
        var url = "http://search.twitter.com/search.json?q=thestar7&callback=?"
        $.getJSON( url, hash_tags_call_back );
    }

    function hash_tags_call_back ( data ) {
        add_to_feed( data.results )
        var list = feed_to_html();
        $( "#output" ).append( list );
    }

    function add_to_feed( results ) {
        $.each( results, function (index, result ) {
            var feed_item = { "text": result.text,
                              "created_at": string_to_date(result.created_at),
                              "from_user": result.from_user
                            }
            feed.push(feed_item);
        });
    }

    function feed_to_html() {
        var list = $( "<ul />" );
        $.each( feed, function( index, item ) {
            var str = item.from_user + ":" + item.text + "(" + item.created_at + ")";
            var element = $( "<li />").text(str);
            element.appendTo( list );
        });
        return list;
    }

    function string_to_date(string) {
        return Date(Date.parse(string));
    }
</script>

<div id="output"></div>
